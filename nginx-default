#proxy_cache_path /var/lib/nginx/cache levels=1:2 keys_zone=backcache:8m max_size=50m;
proxy_cache_path /var/lib/nginx/cache levels=1:2 keys_zone=backcache:15m max_size=20G inactive=60m;
proxy_cache_key "$scheme$request_method$host$request_uri$is_args$args";
proxy_cache_valid 200 302 10m;

server {
	listen 80 default;
	server_name  _; 
    	location / {
		proxy_cache backcache;
		proxy_cache_bypass $http_cache_control;
		add_header X-Proxy-Cache $upstream_cache_status;
		
		proxy_pass http://localhost:8080;
 		proxy_set_header Host            $host;
    		proxy_set_header X-Real-IP       $remote_addr;
    		proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;    
	}
}

server {
	listen 8080;
	root /mowich_data/muckamuck/sites/domain/$host;
	index index.html index.htm;
	#server_name $http_host;
	server_name $host;
	location / {
		# First attempt to serve request as file, then
		# as directory, then fall back to displaying a 404.
		#try_files $uri $uri/ =404;
		try_files $uri /index.html;
		expires -1;
		# Uncomment to enable naxsi on this location
		# include /etc/nginx/naxsi.rules
		# expires 1M;
 		# add_header Cache-Control "public";
	}

        location /tempate.hbs {
                expires 5m;
                add_header Cache-Control "public";
        }
	location /rss.xml {
		expires 1h;
		add_header Cache-Control "public";
	}
        location /robots.txt {
                expires 1M;
                add_header Cache-Control "public";
        }
        location /sitemap.xml {
                expires 1h;
                add_header Cache-Control "public";
        }
        location /image/ {
                try_files $uri $uri/ =404;
                expires 1M;
                add_header Cache-Control "public";
        }
	location /podcast/ {
                try_files $uri $uri/ =404;
                expires 1M;
                add_header Cache-Control "public";
        }
        location /css/ {
                try_files $uri $uri/ =404;
                 expires 2M;
                 add_header Cache-Control "public";
        }

}

